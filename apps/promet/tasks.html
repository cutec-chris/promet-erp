<html>
<body>
<body>
  <div id="not-supported" style="display:none;background-color:#cc3333;color:white; padding:5px;font-weight:bold;">
    Ihr Ger&auml;t unterst&auml;tzt das speichern der Daten nicht !
  </div>
  <div class="toolbar">
    <h1>Aufgaben</h1>
  </div>
  <div class="content">
    <form class="section" id="submitForm">
    neu:
      <input id="task-name" name="task-name" type="text" style="width: 85%" />
      <input type="submit" class="toolbutton" value="+" />
    </form>

    <div class="section">
      <ul id="task-list">
      </ul>
    </div>
    <script type="text/javascript">
    // In memory tasks store
    tasks = [];
    // This will change the view if localStorage isn't available. It
    // returns true or false
    function verifyLocalStorage() {
      if (!window.localStorage) {
        document.querySelector('.section').style.display="none";
        document.querySelector('#not-supported').style.display="block";
        return false;
      }
      return true;
    }
    function TaskDone(e){
      if (e.checked)
        tasks[e.parentElement.parentElement.id].completed='Y';
      else
        tasks[e.parentElement.parentElement.id].completed='N';
      localStorage['tasks'] = JSON.stringify(tasks);
    }
    // This adds a task
    function addTask(task){
      // To the view
      var nli=document.createElement("li");
      var list = document.querySelector('#task-list');
      list.appendChild(nli);
      var ndiv = document.createElement("div");
      nli.appendChild(ndiv);
      ndiv.setAttribute('id',task.lpriority);
      ndiv.innerHTML = '<input type="checkbox" onClick="TaskDone(this);" style="width:auto;display:inline;"><label style="margin-left:5px;">'+task.subject+'</label>';
      ndiv.firstElementChild.checked = task.completed='Y';
      // To memory
      tasks[tasks.length] = task;
      // In storage
      localStorage['tasks'] = JSON.stringify(tasks);
    }
    // Set it all up
    // Notify the user if local storage isn't supported
    if (verifyLocalStorage() == true) {
        // Get the last stored tasks and restore them to the UI.
        // Default to an empty array
        var oldTasks = JSON.parse(localStorage.getItem('tasks') || '[]');
        for (var i=0;i<=oldTasks.length-1;i++)
          addTask(oldTasks[i]);
        // Set up a handler for submission
        document.querySelector('#submitForm').onsubmit=function(){
          // Add the new task
          var aTaskName = document.querySelector('#task-name');
          var newTask = { 'subject' : aTaskName.value,
                          'sql_id' : undefined,
                          'completed' : 'N',
                          'lpriority' : i
                        };
          addTask(newTask);
          // Clear the input
          document.querySelector('#task-name').value = '';
          // Don't post
          return false;
      }
    }
    </script>
  </div>
</body>
</html>
